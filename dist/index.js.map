{"version":3,"sources":["../src/index.js"],"names":["require","config","main","createPrivacyPolicy","insertTestData","app","Models","User","findOne","user","userId","id","toString","hashValue","JSON","stringify","privacyPreference","EvaluateHash","hash","createdAt","$gte","utc","subtract","Number","timeofRetention","permission","console","log","result","Helpers","PrivacyPreference","evaluate","isAccepted","create","PrivacyPolicy","hasData","insertMany","attributes","name","left","right","purposes","deleteMany","App","exceptions","denyAttributes","allowedPurposes","prohibitedPurposes","denyPurposes"],"mappings":"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","sourcesContent":["require(\"dotenv\").config();\nimport \"./services/mongoose\";\nimport Models from \"./models\";\nimport Helpers from \"./helpers\";\nimport md5 from \"md5\";\nimport moment from \"moment\";\n\nmain();\nasync function main() {\n  // create privacy policy\n  await createPrivacyPolicy();\n  // data test\n  await insertTestData();\n  return; // xoa khi chay xong 2 function tren\n  const app = await Models.App.findOne();\n  const user = await Models.User.findOne();\n  const userId = user.id.toString();\n  // // check hash\n  const hashValue = md5(\n    md5(JSON.stringify(app)) + \"-\" + md5(JSON.stringify(user.privacyPreference))\n  );\n\n  const permission = await Models.EvaluateHash.findOne({\n    userId,\n    hash: hashValue,\n    createdAt: {\n      $gte: moment()\n        .utc()\n        .subtract(Number(user.privacyPreference.timeofRetention), \"second\"),\n    },\n  });\n\n  if (permission) {\n    console.log(\"OK\" + permission.result);\n  } else {\n    const isAccepted = await Helpers.PrivacyPreference.evaluate(app, user);\n\n    if (isAccepted) {\n      console.log(\"OK Accepted\");\n    } else {\n      console.log(\"NO Accepted\");\n    }\n    await Models.EvaluateHash.create({\n      userId,\n      hash: hashValue,\n      result: isAccepted ? \"grant\" : \" deny\",\n    });\n  }\n}\n\nasync function createPrivacyPolicy() {\n  const hasData = await Models.PrivacyPolicy.findOne({});\n  if (hasData) return;\n\n  await Models.PrivacyPolicy.insertMany([\n    {\n      attributes: [\n        { name: \"General\", left: 1, right: 31 },\n\n        { name: \"Identifier\", left: 2, right: 7 },\n        { name: \"UserId\", left: 3, right: 4 },\n        { name: \"Name\", left: 5, right: 6 },\n\n        { name: \"Generic\", left: 7, right: 16 },\n        { name: \"Fitness\", left: 8, right: 15 },\n        { name: \"Moverment\", left: 9, right: 10 },\n        { name: \"Height\", left: 11, right: 12 },\n        { name: \"Weight\", left: 13, right: 14 },\n\n        { name: \"Sensitive\", left: 17, right: 30 },\n        { name: \"Position\", left: 18, right: 19 },\n        { name: \"Health\", left: 20, right: 29 },\n        { name: \"Physical state\", left: 21, right: 26 },\n        { name: \"Heart rate\", left: 22, right: 23 },\n        { name: \"Blood pressure\", left: 24, right: 25 },\n        { name: \"Psychological state\", left: 27, right: 28 },\n      ],\n      purposes: [\n        { name: \"General\", left: 1, right: 32 },\n\n        { name: \"Admin\", left: 2, right: 7 },\n        { name: \"Profilling\", left: 3, right: 4 },\n        { name: \"Analysis\", left: 5, right: 6 },\n\n        { name: \"Purchase\", left: 8, right: 9 },\n\n        { name: \"Shipping\", left: 10, right: 11 },\n\n        { name: \"Maketing\", left: 12, right: 31 },\n\n        { name: \"Direct\", left: 13, right: 24 },\n        { name: \"DPhone\", left: 14, right: 15 },\n        { name: \"DEmail\", left: 16, right: 21 },\n        { name: \"Service updates\", left: 17, right: 18 },\n        { name: \"Special offers\", left: 19, right: 20 },\n        { name: \"DFax\", left: 22, right: 23 },\n\n        { name: \"Third-party\", left: 24, right: 30 },\n        { name: \"TEMail\", left: 26, right: 27 },\n        { name: \"TPostal\", left: 28, right: 29 },\n      ],\n    },\n  ]);\n}\nasync function insertTestData() {\n  await Models.EvaluateHash.deleteMany({});\n  await Models.User.deleteMany({});\n  await Models.App.deleteMany({});\n\n  await Models.User.create({\n    privacyPreference: {\n      attributes: [\"6066cba21e18af2e25175a3b\"], // Moverment\n      exceptions: [\"6066cba21e18af2e25175a3c\"], // Height\n      denyAttributes: [\"6066cba21e18af2e25175a3c\"], // Height\n      allowedPurposes: [\"6066cba21e18af2e25175a54\"], // TPostal\n      prohibitedPurposes: [\"6066cba21e18af2e25175a53\"], // TEMail\n      denyPurposes: [\"6066cba21e18af2e25175a53\"], // TEMail\n      timeofRetention: 1000, // second\n    },\n  });\n\n  await Models.App.create({\n    name: \"App 1\",\n    attributes: [\"6066cba21e18af2e25175a3b\"], // Moverment\n    purposes: [\"6066cba21e18af2e25175a54\"], // TPostal,\n    timeofRetention: 500,\n  });\n}\n// test();\n"],"file":"index.js"}