{"version":3,"sources":["../src/index.js"],"names":["main","app","_id","attributes","purposes","timeofRetention","userId","Models","User","findById","user","hashValue","JSON","stringify","privacyPreference","EvaluateHash","findOne","hash","createdAt","$gte","utc","subtract","Number","permission","console","log","result","Helpers","PrivacyPreference","evaluate","isAccepted","create","test","PrivacyPolicy","insertMany","name","left","right"],"mappings":"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","sourcesContent":["import \"./services/mongoose\";\nimport Models from \"./models\";\nimport Helpers from \"./helpers\";\nimport md5 from \"md5\";\nimport moment from \"moment\";\nasync function main() {\n  // data test\n  const app = {\n    _id: \"5fe883d3c517eb0706e0d906\",\n    attributes: [\"5fe883d3c517eb0706e0d90c\"], //\n    purposes: [\"5fe883d3c517eb0706e0d910\"],\n    timeofRetention: 30,\n  };\n  const userId = \"5fe801981e727b08f6e9193e\";\n  const user = await Models.User.findById(userId);\n\n  // check hash\n  const hashValue = md5(\n    JSON.stringify(app) + \"-\" + JSON.stringify(user.privacyPreference)\n  );\n  const permission = await Models.EvaluateHash.findOne({\n    userId,\n    hash: hashValue,\n    createdAt: {\n      $gte: moment()\n        .utc()\n        .subtract(Number(user.privacyPreference.timeofRetention), \"second\"),\n    },\n  });\n  if (permission) {\n    console.log(\"OK\" + permission.result);\n  } else {\n    const isAccepted = await Helpers.PrivacyPreference.evaluate(app, user);\n\n    if (isAccepted) {\n      console.log(\"OK Accepted\");\n    } else {\n      console.log(\"NO Accepted\");\n    }\n    await Models.EvaluateHash.create({\n      userId,\n      hash: hashValue,\n      result: isAccepted ? \"grant\" : \" deny\",\n    });\n  }\n}\n\nmain();\n\nasync function test() {\n  Models.PrivacyPolicy.insertMany([\n    {\n      name: \"App 1\",\n      attributes: [\n        { name: \"Books\", left: 1, right: 12 },\n        { name: \"Programming\", left: 2, right: 11 },\n        { name: \"Languages\", left: 3, right: 4 },\n        { name: \"Databases\", left: 5, right: 10 },\n        { name: \"MongoDB\", left: 6, right: 7 },\n        { name: \"dbm\", left: 8, right: 9 },\n      ],\n      purposes: [\n        { name: \"Direct\", left: 1, right: 8 },\n        { name: \"DPhone\", left: 2, right: 3 },\n        { name: \"DEmail\", left: 4, right: 5 },\n        { name: \"DFax\", left: 6, right: 7 },\n      ],\n    },\n  ]);\n}\n// test();\n"],"file":"index.js"}